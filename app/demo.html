<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script>
        var pubsub = (function() {
            var q = {},
                topics = {},
                subUid = -1;
            //发布消息
            q.publish = function(topic, args) {
                if (!topics[topic]) {
                    return;
                }
                var subs = topics[topic],
                    len = subs.length;
                while (len--) {
                    subs[len].func(topic, args);
                }
                return this;
            };
            //订阅事件
            q.subscribe = function(topic, func) {
                topics[topic] = topics[topic] ? topics[topic] : [];
                var token = (++subUid).toString();
                topics[topic].push({
                    token: token,
                    func: func
                });
                return token;
            };
            return q;
            //取消订阅就不写了，遍历topics，然后通过保存前面返回token，删除指定元素
        })();
        //触发的事件
        var logmsg = function(topics, data) {
                var input = document.querySelectorAll("input[j-model]");
                console.log(input);
                var m = input.getAttribute("j-model");
                console.log("logging:" + input + ":" + m);
            }
            //监听指定的消息'msgName'
        var sub = pubsub.subscribe('change', logmsg);
        //发布消息'msgName'
        pubsub.publish('change', 'hello world');
        //发布无人监听的消息'msgName1'
        pubsub.publish('anotherMsgName', 'me too!');
    </script>
</head>

<body>
    <input type="text" class="myName" j-model="myName"> name: {{myName}}
    <button>清除</button>
</body>

</html>